(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0c7f34"],{5399:function(e,t,a){"use strict";a.r(t);a("7f7f");var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"bg-white px-3",staticStyle:{margin:"-20px","margin-top":"-1rem","margin-bottom":"0!important"}},[t("el-tabs",{on:{"tab-click":e.getList},model:{value:e.preUrl,callback:function(t){e.preUrl=t},expression:"preUrl"}},[t("el-tab-pane",{attrs:{label:"管理员列表",name:"manager"}},[t("div",{staticClass:"d-flex align-items-center"},[t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.openDialog("manager")}}},[e._v("添加管理员")]),t("div",{staticClass:"ml-auto d-flex"},[t("el-input",{staticStyle:{width:"200px"},attrs:{size:"mini",placeholder:"请输入用户名"},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}}),t("el-button",{staticClass:"ml-2",attrs:{type:"info",size:"mini"},on:{click:e.getList}},[e._v("搜索")])],1)],1),t("el-table",{staticClass:"mt-3",staticStyle:{width:"100%"},attrs:{border:"",data:e.managerList}},[t("el-table-column",{attrs:{align:"center",label:"用户头像"},scopedSlots:e._u([{key:"default",fn:function(e){return[t("el-avatar",{attrs:{size:"large",src:e.row.avatar}})]}}])}),t("el-table-column",{attrs:{align:"center",label:"用户名",prop:"username"}}),t("el-table-column",{attrs:{align:"center",label:"所属管理员"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n\t\t\t\t\t"+e._s(t.row.role.name)+"\n\t\t\t\t")]}}])}),t("el-table-column",{attrs:{prop:"status",align:"center",label:"状态"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:a.row.status?"success":"danger",size:"mini",plain:""},on:{click:function(t){return e.changeStatus(a.row)}}},[e._v(e._s(a.row.status?"启用":"禁用")+"\n\t\t\t\t\t")])]}}])}),t("el-table-column",{attrs:{align:"center",label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return e.openDialog("manager",a.row)}}},[e._v("修改")]),t("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return e.deleteItem(a.row)}}},[e._v("删除")])]}}])})],1)],1),t("el-tab-pane",{attrs:{label:"角色列表",name:"role"}},[t("div",{staticClass:"d-flex align-items-center"},[t("el-button",{directives:[{name:"auth",rawName:"v-auth",value:"添加角色",expression:"'添加角色'"}],attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.openDialog("role")}}},[e._v("添加角色")])],1),t("el-table",{staticClass:"mt-3",staticStyle:{width:"100%"},attrs:{border:"",data:e.roleList}},[t("el-table-column",{attrs:{align:"center",label:"角色名称",prop:"name"}}),t("el-table-column",{attrs:{align:"center",label:"角色描述",prop:"desc"}}),t("el-table-column",{attrs:{prop:"status",align:"center",label:"状态"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:a.row.status?"success":"danger",size:"mini",plain:""},on:{click:function(t){return e.changeStatus(a.row)}}},[e._v(e._s(a.row.status?"启用":"禁用")+"\n\t\t\t\t\t")])]}}])}),t("el-table-column",{attrs:{align:"center",label:"操作",width:"250"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return e.openDialog("role",a.row)}}},[e._v("修改")]),t("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return e.openDrawer(a.row)}}},[e._v("配置权限")]),t("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return e.deleteItem(a.row)}}},[e._v("删除")])]}}])})],1)],1),t("el-tab-pane",{attrs:{label:"权限列表",name:"rule"}},[t("div",{staticClass:"d-flex align-items-center"},[t("el-button",{directives:[{name:"auth",rawName:"v-auth",value:"添加规则",expression:"'添加规则'"}],attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.openDialog("rule")}}},[e._v("添加规则")])],1),t("el-tree",{attrs:{data:e.ruleList,props:e.defaultProps,"default-expand-all":"","expand-on-click-node":!1},on:{"node-click":e.handleNodeClick},scopedSlots:e._u([{key:"default",fn:function(a){a.node;var r=a.data;return t("span",{staticClass:"custom-tree-node"},[t("div",[r.menu?t("span",{staticClass:"mr-2 text-muted",class:r.icon?r.icon:"el-icon-star-off"}):t("small",{staticClass:"mr-2 text-muted"},[e._v(e._s(r.method))]),t("span",[e._v(e._s(r.name))]),r.menu?t("span",{staticClass:"badge ml-2"},[e._v(e._s(r.frontpath))]):t("span",{staticClass:"badge badge-secondary ml-2"},[e._v(e._s(r.condition))])]),t("span",[t("el-button",{attrs:{type:r.status?"success":"danger",size:"mini",plain:""},on:{click:function(t){return e.changeStatus(r)}}},[e._v(e._s(r.status?"启用":"禁用")+"\n\t\t\t\t\t  ")]),t("el-button",{directives:[{name:"auth",rawName:"v-auth",value:"添加规则",expression:"'添加规则'"}],attrs:{type:"text",size:"mini"},on:{click:function(t){return e.openDialog("rule",r.id)}}},[e._v("增加")]),t("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return e.openDialog("rule",r)}}},[e._v("修改")]),t("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return e.deleteItem(r)}}},[e._v("删除")])],1)])}}])})],1)],1),t("div",{staticStyle:{height:"60px"}}),"rule"!=e.preUrl?t("el-footer",{staticClass:"border-top d-flex align-items-center px-0 position-fixed bg-white",staticStyle:{bottom:"0",left:"200px",right:"0","z-index":"100"}},[t("div",{staticClass:"px-2",staticStyle:{flex:"1"}},[t("el-pagination",{attrs:{"current-page":e.page.current,"page-sizes":e.page.sizes,"page-size":e.page.size,layout:"total, sizes, prev, pager, next, jumper",total:e.page.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)]):e._e(),t("el-dialog",{attrs:{title:"提示",visible:e.dialogVisible,width:"70%","before-close":e.handleClose},on:{"update:visible":function(t){e.dialogVisible=t}}},["manager"===e.preUrl?t("el-form",{ref:"form",attrs:{model:e.form.manager,"label-width":"80px"}},[t("el-form-item",{attrs:{label:"用户名",prop:"username"}},[t("el-input",{staticStyle:{width:"25%"},attrs:{placeholder:"用户名",size:"mini"},model:{value:e.form.manager.username,callback:function(t){e.$set(e.form.manager,"username",t)},expression:"form.manager.username"}})],1),t("el-form-item",{attrs:{label:"密码",prop:"password"}},[t("el-input",{staticStyle:{width:"25%"},attrs:{placeholder:"密码",size:"mini"},model:{value:e.form.manager.password,callback:function(t){e.$set(e.form.manager,"password",t)},expression:"form.manager.password"}})],1),t("el-form-item",{attrs:{label:"头像"}},[t("div",[e.form.manager.avatar?t("img",{staticClass:"rounded",staticStyle:{width:"45px",height:"45px",cursor:"pointer"},attrs:{src:e.form.manager.avatar},on:{click:e.chooseImage}}):t("span",{staticClass:"btn btn-light border mr-2",on:{click:e.chooseImage}},[t("i",{staticClass:"el-icon-plus"})])])]),t("el-form-item",{attrs:{label:"所属角色"}},[t("el-select",{attrs:{placeholder:"请选择所属角色",size:"mini"},model:{value:e.form.manager.role_id,callback:function(t){e.$set(e.form.manager,"role_id",t)},expression:"form.manager.role_id"}},e._l(e.roleOptions,(function(e,a){return t("el-option",{key:a,attrs:{label:e.name,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"状态"}},[t("el-radio-group",{attrs:{size:"mini"},model:{value:e.form.manager.status,callback:function(t){e.$set(e.form.manager,"status",t)},expression:"form.manager.status"}},[t("el-radio",{attrs:{label:1,border:""}},[e._v("启用")]),t("el-radio",{attrs:{label:0,border:""}},[e._v("禁用")])],1)],1)],1):e._e(),"role"===e.preUrl?t("el-form",{ref:"form",attrs:{model:e.form.role,"label-width":"80px"}},[t("el-form-item",{attrs:{label:"角色名称",prop:"name"}},[t("el-input",{staticStyle:{width:"25%"},attrs:{placeholder:"角色名称",size:"mini"},model:{value:e.form.role.name,callback:function(t){e.$set(e.form.role,"name",t)},expression:"form.role.name"}})],1),t("el-form-item",{attrs:{label:"角色描述",prop:"desc"}},[t("el-input",{attrs:{type:"textarea",placeholder:"角色描述",size:"mini"},model:{value:e.form.role.desc,callback:function(t){e.$set(e.form.role,"desc",t)},expression:"form.role.desc"}})],1),t("el-form-item",{attrs:{label:"状态"}},[t("el-radio-group",{attrs:{size:"mini"},model:{value:e.form.role.status,callback:function(t){e.$set(e.form.role,"status",t)},expression:"form.role.status"}},[t("el-radio",{attrs:{label:1,border:""}},[e._v("启用")]),t("el-radio",{attrs:{label:0,border:""}},[e._v("禁用")])],1)],1)],1):e._e(),"rule"===e.preUrl?t("el-form",{ref:"form",attrs:{model:e.form.rule,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"上级规则"}},[t("el-select",{attrs:{placeholder:"请选择上级规则",size:"mini"},model:{value:e.form.rule.rule_id,callback:function(t){e.$set(e.form.rule,"rule_id",t)},expression:"form.rule.rule_id"}},[t("el-option",{attrs:{label:"顶级规则",value:0}}),e._l(e.ruleOptions,(function(a,r){return t("el-option",{key:r,attrs:{label:e._f("tree")(a),value:a.id}})}))],2)],1),t("el-form-item",{attrs:{label:"菜单/规则"}},[t("el-radio-group",{attrs:{size:"mini"},model:{value:e.form.rule.menu,callback:function(t){e.$set(e.form.rule,"menu",t)},expression:"form.rule.menu"}},[t("el-radio",{attrs:{label:1,border:""}},[e._v("菜单")]),t("el-radio",{attrs:{label:0,border:""}},[e._v("规则")])],1)],1),t("el-form-item",{attrs:{label:"名称"}},[t("el-input",{staticStyle:{width:"25%"},attrs:{placeholder:"名称",size:"mini"},model:{value:e.form.rule.name,callback:function(t){e.$set(e.form.rule,"name",t)},expression:"form.rule.name"}})],1),e.form.rule.menu?t("el-form-item",{attrs:{label:"图标"}},[t("el-input",{attrs:{placeholder:"图标",size:"mini"},model:{value:e.form.rule.icon,callback:function(t){e.$set(e.form.rule,"icon",t)},expression:"form.rule.icon"}})],1):e._e(),e.form.rule.menu&&e.form.rule.rule_id>0?t("el-form-item",{attrs:{label:"前端路由路径"}},[t("el-input",{attrs:{placeholder:"前端路由路径",size:"mini"},model:{value:e.form.rule.frontpath,callback:function(t){e.$set(e.form.rule,"frontpath",t)},expression:"form.rule.frontpath"}})],1):e._e(),e.form.rule.menu?t("el-form-item",{attrs:{label:"前台路由别名"}},[t("el-input",{attrs:{placeholder:"前台路由别名",size:"mini"},model:{value:e.form.rule.desc,callback:function(t){e.$set(e.form.rule,"desc",t)},expression:"form.rule.desc"}})],1):e._e(),e.form.rule.menu?e._e():t("el-form-item",{attrs:{label:"后端规则"}},[t("el-input",{attrs:{placeholder:"后端规则",size:"mini"},model:{value:e.form.rule.condition,callback:function(t){e.$set(e.form.rule,"condition",t)},expression:"form.rule.condition"}})],1),e.form.rule.menu?e._e():t("el-form-item",{attrs:{label:"请求方式"}},[t("el-select",{attrs:{placeholder:"请选择请求方式",size:"mini"},model:{value:e.form.rule.method,callback:function(t){e.$set(e.form.rule,"method",t)},expression:"form.rule.method"}},[t("el-option",{attrs:{label:"GET",value:"GET"}}),t("el-option",{attrs:{label:"POST",value:"POST"}}),t("el-option",{attrs:{label:"PUT",value:"PUT"}}),t("el-option",{attrs:{label:"DELETE",value:"DELETE"}})],1)],1),t("el-form-item",{attrs:{label:"状态"}},[t("el-radio-group",{attrs:{size:"mini"},model:{value:e.form.rule.status,callback:function(t){e.$set(e.form.rule,"status",t)},expression:"form.rule.status"}},[t("el-radio",{attrs:{label:1,border:""}},[e._v("启用")]),t("el-radio",{attrs:{label:0,border:""}},[e._v("禁用")])],1)],1)],1):e._e(),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v("确 定")])],1)],1),t("el-drawer",{attrs:{title:"配置权限",visible:e.drawer,direction:"rtl","before-close":e.handleClose,size:"40%"},on:{"update:visible":function(t){e.drawer=t}}},[t("div",{staticStyle:{position:"absolute",top:"52px",left:"0",right:"0",bottom:"0"}},[t("div",{staticStyle:{position:"absolute",top:"0",left:"0",right:"0",bottom:"60px","overflow-y":"auto"}},[t("el-tree",{attrs:{data:e.ruleList,"show-checkbox":"","node-key":"id","default-expand-all":"","default-checked-keys":e.checkedKeys,props:e.defaultProps,"check-strictly":!0},on:{check:e.check}})],1),t("div",{staticClass:"border d-flex align-items-center px-3 bg-white",staticStyle:{height:"60px",position:"absolute",bottom:"0",right:"0",left:"0"}},[t("el-button",{on:{click:function(t){e.drawer=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.submitRules}},[e._v("确定")])],1)])])],1)},l=[],o=a("6590"),i={mixins:[o["a"]],inject:["app","layout"],data:function(){return{keyword:"",preUrl:"manager",managerList:[],roleList:[],ruleList:[],defaultProps:{children:"child",label:"name"},dialogVisible:!1,dialogType:"manager",roleOptions:[],ruleOptions:[],dialogId:0,form:{manager:{username:"",password:"",avatar:"",role_id:"",status:1},role:{name:"",desc:"",status:1},rule:{menu:0,rule_id:"",name:"",status:1,frontpath:"",desc:"",condition:"",icon:"",method:"GET",order:50}},drawer:!1,drawerId:0,checkedKeys:[]}},filters:{tree:function(e){if(0==e.level)return e.name;for(var t="",a=0;a<e.level;a++)t+=0==a?"|--":"--";return t+" "+e.name}},methods:{openDialog:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];switch(this.dialogType=e,e){case"manager":t?(this.form.manager={username:t.username,password:t.password,avatar:t.avatar,role_id:t.role_id,status:t.status},this.dialogId=t.id):(this.form.manager={username:"",password:"",avatar:"",role_id:"",status:1},this.dialogId=0);break;case"role":t?(this.form.role={name:t.name,desc:t.desc,status:t.status},this.dialogId=t.id):(this.form.role={name:"",desc:"",status:1},this.dialogId=0);break;case"rule":t&&"number"!==typeof t?(this.form.rule={menu:t.menu,rule_id:t.rule_id,name:t.name,status:t.status,frontpath:t.frontpath,desc:t.desc,condition:t.condition,icon:t.icon,method:t.method,order:50},this.dialogId=t.id):(this.form.rule={menu:0,rule_id:"",name:"",status:1,frontpath:"",desc:"",condition:"",icon:"",method:"GET",order:50},this.form.rule.rule_id=t,this.dialogId=0);break}this.dialogVisible=!0},handleClose:function(e){this.$confirm("确认关闭？").then((function(t){e()})).catch((function(e){}))},getListUrl:function(){return"manager"===this.preUrl?"/admin/".concat(this.preUrl,"/").concat(this.page.current,"?limit=").concat(this.page.size,"&keyword=").concat(this.keyword):"/admin/".concat(this.preUrl,"/").concat(this.page.current,"?limit=").concat(this.page.size)},getListResult:function(e){switch(console.log(e),this.preUrl){case"manager":this.managerList=e.list,this.roleOptions=e.role;break;case"role":this.roleList=e.list;break;case"rule":this.ruleList=e.list,this.ruleOptions=e.rules;break}},submit:function(){this.addOrEdit(this.form[this.preUrl],this.dialogId),this.dialogVisible=!1},handleNodeClick:function(e){console.log(e)},chooseImage:function(){var e=this;this.app.chooseImage((function(t){e.form.manager.avatar=t[0].url}),1)},openDrawer:function(e){var t=this;console.log(e),this.layout.showLoading(),this.axios.get("/admin/rule/1",{token:!0}).then((function(a){t.drawer=!0,t.ruleList=a.data.data.list,t.checkedKeys=e.rules.map((function(e){return e.id})),t.drawerId=e.id,t.layout.hideLoading()})).catch((function(e){t.layout.hideLoading()}))},check:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];this.checkedKeys=t[1].checkedKeys},submitRules:function(){var e=this;this.axios.post("/admin/role/set_rules",{id:this.drawerId,rule_ids:this.checkedKeys},{token:!0}).then((function(t){e.drawer=!1,e.getList(),e.$message({type:"success",message:"配置成功"})}))}}},s=i,n=a("2877"),c=Object(n["a"])(s,r,l,!1,null,null,null);t["default"]=c.exports}}]);
//# sourceMappingURL=chunk-2d0c7f34.83594642.js.map