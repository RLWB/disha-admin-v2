(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-57288f4e"],{a883:function(t,e,i){},c8cb:function(t,e,i){"use strict";i("a883")},e036:function(t,e,i){"use strict";i.r(e);i("7f7f");var a=function(){var t=this,e=t._self._c;return e("div",[e("el-container",{staticStyle:{position:"absolute",top:"55px",bottom:"0",left:"0",right:"0"}},[e("el-header",{staticClass:"d-flex align-items-center border-bottom"},[e("div",{staticClass:"d-flex mr-auto"},[e("el-select",{staticClass:"mr-2",staticStyle:{width:"150px"},attrs:{placeholder:"请选择图片排序方式",size:"mini"},model:{value:t.searchForm.order,callback:function(e){t.$set(t.searchForm,"order",e)},expression:"searchForm.order"}},[e("el-option",{attrs:{label:"降序",value:"desc"}}),e("el-option",{attrs:{label:"升序",value:"asc"}})],1),e("el-input",{staticClass:"mr-2",staticStyle:{width:"150px"},attrs:{size:"mini",placeholder:"输入图片名称"},model:{value:t.searchForm.keyword,callback:function(e){t.$set(t.searchForm,"keyword",e)},expression:"searchForm.keyword"}}),e("el-button",{attrs:{type:"success",size:"mini"},on:{click:t.getImageList}},[t._v("搜索")])],1),t.chooseList.length?e("el-button",{attrs:{type:"warning",size:"mini"},on:{click:t.unChoose}},[t._v("\n\t\t  \t\t\t\t取消选中")]):t._e(),t.chooseList.length?e("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(e){return t.imageDel({all:!0})}}},[t._v("\n\t\t\t批量删除")]):t._e(),e("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(e){return t.openAlbumModel(!1)}}},[t._v("创建相册")]),e("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(e){t.uploadModel=!0}}},[t._v("上传图片")])],1),e("el-container",[e("el-aside",{staticClass:"bg-white border-right",staticStyle:{position:"absolute",top:"60px",left:"0",bottom:"60px"},attrs:{width:"200px"}},[e("ul",{staticClass:"list-group list-group-flush"},t._l(t.albums,(function(i,a){return e("album-item",{key:a,attrs:{item:i,index:a,active:t.albumIndex===a},on:{change:t.albumChange,edit:t.openAlbumModel,del:t.albumDel}})})),1)]),e("el-container",[e("el-main",{staticStyle:{position:"absolute",top:"60px",left:"200px",bottom:"60px",right:"0"}},[e("el-row",{attrs:{gutter:10}},t._l(t.imageList,(function(i,a){return e("el-col",{key:a,attrs:{span:24,lg:4,md:6,sm:8}},[e("el-card",{staticClass:"box-card mb-3 position-relative",staticStyle:{cursor:"pointer"},attrs:{"body-style":{padding:"0"},shadow:"hover"}},[e("div",{staticClass:"border",class:{"border-danger":i.ischeck}},[i.ischeck?e("span",{staticClass:"badge badge-danger",staticStyle:{position:"absolute",right:"0",top:"0"}},[t._v("\n\t\t\t\t\t\t"+t._s(i.checkOrder))]):t._e(),e("img",{staticClass:"w-100",staticStyle:{height:"100px"},attrs:{src:i.url},on:{click:function(e){return t.choose(i)}}}),e("div",{staticClass:"w-100 text-white px-1",staticStyle:{background:"rgba(0,0,0,0.5)","margin-top":"-25px",position:"absolute"}},[e("span",{staticClass:"small"},[t._v(t._s(i.name))])]),e("div",{staticClass:"p-2 text-center"},[e("el-button-group",[e("el-button",{staticClass:"p-2",attrs:{icon:"el-icon-view",size:"mini"},on:{click:function(e){return t.previewImage(i)}}}),e("el-button",{staticClass:"p-2",attrs:{icon:"el-icon-edit",size:"mini"},on:{click:function(e){return t.imageEdit(i,a)}}}),e("el-button",{staticClass:"p-2",attrs:{icon:"el-icon-delete",size:"mini"},on:{click:function(e){return t.imageDel({index:a,item:i})}}})],1)],1)])])],1)})),1)],1)],1)],1),e("el-footer",{staticClass:"border-top d-flex align-items-center px-0"},[e("div",{staticClass:"h-100 d-flex align-items-center justify-content-center border-right",staticStyle:{width:"200px","flex-shrink":"0"}},[e("el-button-group",[e("el-button",{attrs:{size:"mini",disabled:1===t.albumPage},on:{click:function(e){return t.changeAlbumPage("pre")}}},[t._v("上一页")]),e("el-button",{attrs:{size:"mini",disabled:t.albumPage===Math.ceil(t.albumTotal/10)},on:{click:function(e){return t.changeAlbumPage("next")}}},[t._v("下一页")])],1)],1),e("div",{staticClass:"px-2",staticStyle:{flex:"1"}},[e("el-pagination",{attrs:{"current-page":t.currentPage,"page-sizes":t.pageSizes,"page-size":t.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)])],1),e("el-dialog",{attrs:{title:t.albumModelTitle,visible:t.albumModel},on:{"update:visible":function(e){t.albumModel=e}}},[e("el-form",{ref:"form",attrs:{model:t.albumForm,"label-width":"80px"}},[e("el-form-item",{attrs:{label:"相册名称"}},[e("el-input",{attrs:{size:"medium",placeholder:"请输入相册名称"},model:{value:t.albumForm.name,callback:function(e){t.$set(t.albumForm,"name",e)},expression:"albumForm.name"}})],1),e("el-form-item",{attrs:{label:"相册排序"}},[e("el-input-number",{attrs:{min:0,size:"medium"},model:{value:t.albumForm.order,callback:function(e){t.$set(t.albumForm,"order",e)},expression:"albumForm.order"}})],1)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.albumModel=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.confirmAlbumModel}},[t._v("确 定")])],1)],1),e("el-dialog",{attrs:{title:"上传图片",visible:t.uploadModel},on:{"update:visible":function(e){t.uploadModel=e},close:t.__init}},[e("div",{staticClass:"text-center"},[e("el-upload",{staticClass:"upload-demo w-100",attrs:{drag:"",action:"/admin/image/upload",multiple:"",headers:{token:t.$store.state.user.token},data:{image_class_id:t.image_class_id},name:"img","on-success":t.uploadSuccess}},[e("i",{staticClass:"el-icon-upload"}),e("div",{staticClass:"el-upload__text"},[t._v("将文件拖到此处，或"),e("em",[t._v("点击上传")])]),e("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("只能上传jpg/png文件，且不超过500kb")])])],1)]),e("el-dialog",{attrs:{visible:t.previewModel,width:"60vw",top:"5vh"},on:{"update:visible":function(e){t.previewModel=e}}},[e("div",{staticStyle:{margin:"-60px -20px -30px -20px"}},[e("img",{staticClass:"w-100",attrs:{src:t.previewUrl}})])])],1)},s=[],n=(i("20d6"),i("ac6a"),i("b832")),o={inject:["layout"],components:{albumItem:n["a"]},data:function(){return{uploadModel:!1,searchForm:{order:"desc",keyword:""},albumIndex:0,albumModel:!1,albumEditIndex:-1,albumForm:{name:"",order:0},albums:[],albumPage:1,albumTotal:0,previewModel:!1,previewUrl:"",imageList:[],chooseList:[],currentPage:1,pageSize:10,pageSizes:[10,20,50,100],total:10}},computed:{albumModelTitle:function(){return this.albumEditIndex>-1?"修改相册":"创建相册"},image_class_id:function(){var t=this.albums[this.albumIndex];return t?t.id:0},getImageListUrl:function(){var t="";return""!=this.searchForm.keyword&&(t="&keyword=".concat(this.searchForm.keyword)),"/admin/imageclass/".concat(this.image_class_id,"/image/").concat(this.currentPage,"?limit=").concat(this.pageSize,"&order=").concat(this.searchForm.order).concat(t)}},created:function(){this.__init()},methods:{unChoose:function(){var t=this;this.imageList.forEach((function(e){var i=t.chooseList.findIndex((function(t){return t.id===e.id}));i>-1&&(e.ischeck=!1,e.checkOrder=0,t.chooseList.splice(i,1))}))},choose:function(t){var e=this;if(!t.ischeck)return this.chooseList.push({id:t.id,url:t.url}),t.checkOrder=this.chooseList.length,void(t.ischeck=!0);var i=this.chooseList.findIndex((function(e){return e.id===t.id}));if(-1!==i){var a=this.chooseList.length;if(i+1<a)for(var s=function(t){var i=e.imageList.findIndex((function(i){return i.id===e.chooseList[t].id}));i>-1&&e.imageList[i].checkOrder--},n=i;n<a;n++)s(n);this.chooseList.splice(i,1),t.ischeck=!1,t.checkOrder=0}},getImageList:function(){var t=this;this.layout.showLoading(),this.axios.get(this.getImageListUrl,{token:!0}).then((function(e){var i=e.data.data;t.imageList=i.list.map((function(t){return{id:t.id,url:t.url,name:t.name,ischeck:!1,checkOrder:0}})),t.total=i.totalCount,t.layout.hideLoading()})).catch((function(e){t.layout.hideLoading()}))},__init:function(){var t=this;this.layout.showLoading(),this.axios.get("/admin/imageclass/"+this.albumPage,{token:!0}).then((function(e){var i=e.data.data;t.albums=i.list,t.albumTotal=i.totalCount,t.getImageList()})).catch((function(e){t.layout.hideLoading()}))},albumChange:function(t){this.albumIndex=t,this.getImageList()},openAlbumModel:function(t){if(t){var e=t.item,i=t.index;return this.albumForm.name=e.name,this.albumForm.order=e.order,this.albumEditIndex=i,this.albumModel=!0}this.albumForm={name:"",order:0},this.albumEditIndex=-1,this.albumModel=!0},confirmAlbumModel:function(){var t=this;if(this.albumEditIndex>-1)return this.albumEdit(),this.albumModel=!1;this.layout.showLoading(),this.axios.post("/admin/imageclass",this.albumForm,{token:!0}).then((function(e){t.albumModel=!1,t.layout.hideLoading(),t.$message({message:"创建成功",type:"success"}),t.__init()})).catch((function(e){t.layout.hideLoading()}))},albumEdit:function(){var t=this,e=this.albums[this.albumEditIndex];this.layout.showLoading(),this.axios.post("/admin/imageclass/"+e.id,this.albumForm,{token:!0}).then((function(e){t.$message({message:"修改成功",type:"success"}),t.layout.hideLoading(),t.__init()})).catch((function(e){t.layout.hideLoading()}))},albumDel:function(t){var e=this;this.$confirm("是否删除该相册","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var i=e.albums[t].id;e.layout.showLoading(),e.axios.delete("/admin/imageclass/"+i,{token:!0}).then((function(t){e.$message({message:"删除成功",type:"success"}),e.__init(),e.layout.hideLoading()})).catch((function(t){e.layout.hideLoading()}))}))},previewImage:function(t){this.previewUrl=t.url,this.previewModel=!0},imageEdit:function(t,e){var i=this;this.$prompt("请输入新名称","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputValue:t.name,inputValidator:function(t){if(""===t)return"图片名称不能为空"}}).then((function(e){var a=e.value;i.layout.showLoading(),i.axios.post("/admin/image/"+t.id,{name:a},{token:!0}).then((function(t){i.__init(),i.layout.hideLoading(),i.$message({message:"修改成功",type:"success"})})).catch((function(t){i.layout.hideLoading()}))}))},imageDel:function(t){var e=this;this.$confirm(t.all?"是否删除选中图片?":"是否删除该图片?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){if(e.layout.showLoading(),t.all){var i=e.chooseList.map((function(t){return t.id}));e.axios.post("/admin/image/delete_all",{ids:i},{token:!0}).then((function(t){e.$message({message:"删除成功",type:"success"}),e.__init(),e.chooseList=[],e.layout.hideLoading()})).catch((function(t){e.layout.hideLoading()}))}else e.axios.delete("/admin/image/"+t.item.id,{token:!0}).then((function(t){e.$message({message:"删除成功",type:"success"}),e.__init(),e.layout.hideLoading()})).catch((function(t){e.layout.hideLoading()}))}))},handleSizeChange:function(t){this.pageSize=t,this.getImageList()},handleCurrentChange:function(t){this.currentPage=t,this.getImageList()},changeAlbumPage:function(t){"pre"===t?this.albumPage--:this.albumPage++,this.__init()},uploadSuccess:function(t,e,i){console.log(t,e,i)}}},l=o,c=(i("c8cb"),i("2877")),r=Object(c["a"])(l,a,s,!1,null,null,null);e["default"]=r.exports}}]);
//# sourceMappingURL=chunk-57288f4e.951e9d4d.js.map